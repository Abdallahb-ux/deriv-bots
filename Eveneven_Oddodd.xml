<xml xmlns="https://developers.google.com/blockly/xml" is_dbot="true" collection="false">
  <variables>
    <variable id="smartRisk">smartRisk</variable>
  </variables>

  <!-- Initialize bot settings -->
  <block type="run_once" id="init_smartrisk" x="20" y="20">
    <statement name="DO">
      <block type="variables_set" id="set_smartrisk">
        <field name="VAR" id="smartRisk">smartRisk</field>
        <value name="VALUE">
          <block type="smartrisk_settings" id="smartrisk_settings_block">
            <field name="STRATEGY">martingale</field>
            <value name="INVESTMENT">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="TAKE_PROFIT">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
            <value name="STOP_LOSS">
              <shadow type="math_number">
                <field name="NUM">-10</field>
              </shadow>
            </value>
            <value name="PARAMETERS">
              <block type="lists_create_with">
                <mutation items="1"></mutation>
                <value name="ADD0">
                  <block type="math_number">
                    <field name="NUM">2</field>
                  </block>
                </value>
              </block>
            </value>
          </block>
        </value>
      </block>
    </statement>
  </block>

  <!-- Main trade block -->
  <block type="trade" id="main_trade" x="20" y="200">
    <field name="MARKET_LIST">synthetic_index</field>
    <field name="SUBMARKET_LIST">random_index</field>
    <field name="SYMBOL_LIST">R_100</field>
    <field name="TRADETYPECAT_LIST">digits</field>
    <field name="TRADETYPE_LIST">evenodd</field>
    <field name="TYPE_LIST">both</field>
    <field name="CANDLEINTERVAL_LIST">60</field>
    <field name="TIME_MACHINE_ENABLED">TRUE</field>
    <field name="RESTARTONERROR">TRUE</field>

    <!-- Before purchase: choose ODD/EVEN based on sequence step -->
    <statement name="SUBMARKET">
      <block type="before_purchase" id="before_purchase_sequence">
        <statement name="BEFOREPURCHASE_STACK">
          <block type="controls_if" id="sequence_check">
            <mutation elseif="3"></mutation>

            <value name="IF0">
              <block type="logic_compare">
                <field name="OP">EQ</field>
                <value name="A"><block type="smartrisk_query">
                  <field name="SMARTRISK_LIST">sequenceStep</field>
                  <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                </block></value>
                <value name="B"><block type="math_number"><field name="NUM">0</field></block></value>
              </block>
            </value>
            <statement name="DO0">
              <block type="smartrisk_prepare">
                <field name="SMARTRISKFIELD_LIST">DIGITODD</field>
                <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                <next>
                  <block type="purchase"><field name="PURCHASE_LIST">DIGITODD</field></block>
                </next>
              </block>
            </statement>

            <value name="IF1">
              <block type="logic_compare">
                <field name="OP">EQ</field>
                <value name="A"><block type="smartrisk_query">
                  <field name="SMARTRISK_LIST">sequenceStep</field>
                  <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                </block></value>
                <value name="B"><block type="math_number"><field name="NUM">1</field></block></value>
              </block>
            </value>
            <statement name="DO1">
              <block type="smartrisk_prepare">
                <field name="SMARTRISKFIELD_LIST">DIGITODD</field>
                <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                <next>
                  <block type="purchase"><field name="PURCHASE_LIST">DIGITODD</field></block>
                </next>
              </block>
            </statement>

            <value name="IF2">
              <block type="logic_compare">
                <field name="OP">EQ</field>
                <value name="A"><block type="smartrisk_query">
                  <field name="SMARTRISK_LIST">sequenceStep</field>
                  <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                </block></value>
                <value name="B"><block type="math_number"><field name="NUM">2</field></block></value>
              </block>
            </value>
            <statement name="DO2">
              <block type="smartrisk_prepare">
                <field name="SMARTRISKFIELD_LIST">DIGITEVEN</field>
                <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                <next>
                  <block type="purchase"><field name="PURCHASE_LIST">DIGITEVEN</field></block>
                </next>
              </block>
            </statement>

            <value name="IF3">
              <block type="logic_compare">
                <field name="OP">EQ</field>
                <value name="A"><block type="smartrisk_query">
                  <field name="SMARTRISK_LIST">sequenceStep</field>
                  <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                </block></value>
                <value name="B"><block type="math_number"><field name="NUM">3</field></block></value>
              </block>
            </value>
            <statement name="DO3">
              <block type="smartrisk_prepare">
                <field name="SMARTRISKFIELD_LIST">DIGITEVEN</field>
                <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                <next>
                  <block type="purchase"><field name="PURCHASE_LIST">DIGITEVEN</field></block>
                </next>
              </block>
            </statement>

          </block>
        </statement>
      </block>
    </statement>

    <!-- After purchase: update result, martingale, sequence step, TP/SL -->
    <statement name="AFTER_PURCHASE">
      <block type="after_purchase" id="after_purchase_logic">
        <statement name="AFTERPURCHASE_STACK">
          <block type="smartrisk_result">
            <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
            <value name="SMARTRISKFIELD_TOLERANCE">
              <shadow type="math_number"><field name="NUM">0.1</field></shadow>
            </value>
            <next>
              <block type="smartrisk_query">
                <field name="SMARTRISK_LIST">continueTrade</field>
                <field name="SMARTRISK_VAR" id="smartRisk">smartRisk</field>
                <next>
                  <block type="trade_again"/>
                </next>
              </block>
            </next>
          </block>
        </statement>
      </block>
    </statement>
  </block>
</xml>
